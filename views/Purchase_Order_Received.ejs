<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
      const ws = new WebSocket("ws://localhost:8001");
      ws.onmessage = receiveMessage;
    </script>
    <%- include ('header_login.ejs') %>
    <!--비정상 접근 차단-->
    <% if(typeof(pass) === 'undefined') { %>
    <script type="text/javascript">
      alert("비정상적인 접근입니다.");
      window.location.href = "/";
    </script>
    <% } else if(pass == 'NONE') { %>
    <script type="text/javascript">
      alert("로그인이 필요합니다.");
      window.location.href = "/";
    </script>
    <% } else if(typeof(req) === 'undefined') { %>
    <script type="text/javascript">
      alert("비정상적인 접근입니다.");
      window.location.href = "/";
    </script>
    <% } %>

    <style>
      input {
        outline: none;
        border: none;
      }

      li {
        list-style: none;
      }
      img {
        width: 100%;
      }
      .real-upload {
        display: none;
      }

      .upload {
        width: 20px;
        height: 20px;
        background-color: #444444;
      }

      .image-preview {
        gap: 20px;
      }
    </style>
  </head>
  <body>
    <div style="height: 50px"></div>
    <div class="d-flex flex-wrap" style="margin: auto; width: 900px">
      <table class="table table-hover" id="POtable">
        <thead>
          <tr>
            <th scope="col">제목</th>
            <th scope="col">보낸 업체</th>

            <th scope="col">발주일</th>
            <th scope="col">납품기한</th>
          </tr>
        </thead>
        <tbody>
          <%if (typeof(req.session.Received_Order) !== 'undefined') { for (var
          key in req.session.Received_Order) { %>
          <tr
            onclick="toggleDiv(myDIV),toggleDiv(myDIV2),toggleDiv(POtable),toggleDiv(Purchase_Order_<%=key%>) ;"
          >
            <th scope="row"><%= req.session.Received_Order[key]["Title"] %></th>
            <td><%= req.session.CompanyInfo[key]["Comp_NAME"] %></td>
            <td>
              <%= req.session.Received_Order[key]["Order_Date"].split(' ')[0] %>
            </td>
            <td>
              <%= req.session.Received_Order[key]["Delivery_Date"].split(' ')[0]
              %>
            </td>
          </tr>
          <%}}%>
        </tbody>
      </table>
    </div>
    <!--채팅창 파트!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-->
    <div class="d-flex flex-wrap justify-content-center">
      <div id="BIG_DIV" class="d-flex flex-wrap justify-content-center">
        <div style="width: 10px"></div>
        <div
          class="col_resize"
          style="
            text-align: center;
            background-color: white;
            display: none;
            min-width: 900px;
            max-height: 900px;
            height: 700px;
          "
          id="myDIV"
        >
          <button
            type="button"
            onclick="
            toggleDiv(myDIV),toggleDiv(myDIV2),
              <% for(var key in req.session.Received_Order) {%>
                  Display_none(Purchase_Order_<%=key%>), 
              <%}%>
                  toggleDiv(POtable);"
            style="
              float: left;
              background-color: transparent;
              border: transparent;
            "
          >
            <i class="bi bi-x-lg"></i>
          </button>
          <button
            onclick="window.open('/PO_edit','_blank')"
            style="font-size: 2vmin; justify-items: end"
            class="btn btn-light"
          >
            수정
          </button>
          <div><%- include ('Purchase_Order_Received_form.ejs') %></div>
        </div>
        <div style="width: 10px"></div>
        <div class="col_resize_empty_2">&nbsp;</div>
        <div
          class="col_resize_chat content MY_DIV2_SIZE_960"
          id="myDIV2"
          style="text-align: center; display: none"
        >
          <div
            id="chat_tables"
            class="col-12 test"
            style="
              word-break: break-all;
              border: var(--bs-border-color-translucent) 1px solid;
              background-color: #d2e9f2;
              min-height: 600px;
              max-height: 1100px;
              height: 300px;
              overflow-y: scroll;
            "
          ></div>
          <div id="BUTTON_DIV" class="d-flex">
            <input
              type="text"
              rows="3"
              id="txt_on"
              style="width: 100%; border: transparent; outline: none"
              onkeydown="enterkey()"
            />
            <button
              type="button"
              onclick=" sendMessage();"
              class="btn btn-secondary"
              style="
                border: var(--bs-border-color-translucent) 1px solid;
                border-radius: 0;
              "
            >
              <i class="bi bi-send"></i>
            </button>
          </div>
        </div>
        <div
          class="col-12"
          id="myDIv3"
          style="text-align: center; height: 50px"
        >
          &nbsp;
        </div>
      </div>
    </div>
  </body>
</html>

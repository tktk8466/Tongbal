<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
      const ws = new WebSocket("ws://localhost:8001");
      ws.onmessage = receiveMessage;
    </script>
    <%- include ('header_login.ejs') %> <% if(typeof(pass) === 'undefined') { %>
    <script type="text/javascript">
      alert("비정상적인 접근입니다.");
      window.location.href = "/";
    </script>
    <% } else if(pass == 'NONE') { %>
    <script type="text/javascript">
      alert("로그인이 필요합니다.");
      window.location.href = "/";
    </script>
    <% } else if(typeof(req) === 'undefined') { %>
    <script type="text/javascript">
      alert("비정상적인 접근입니다.");
      window.location.href = "/";
    </script>
    <% } %>

    <style>
      input {
        outline: none;
        border: none;
      }

      li {
        list-style: none;
      }
      img {
        width: 100%;
      }
      .real-upload {
        display: none;
      }

      .upload {
        width: 20px;
        height: 20px;
        background-color: #444444;
      }

      .image-preview {
        gap: 20px;
      }
    </style>
  </head>
  <body>
    <div style="height: 50px"></div>

    <div class="d-flex flex-wrap justify-content-center">
      <div class="col_resize_empty">&nbsp;</div>
      <div
        class="col_resize"
        style="
          text-align: center;
          font-size: 1vmax;
          position: relative;
          height: 35vh;
        "
      >
        <table class="table table-hover" id="POtable" onclick="toggletoggle()">
          <thead>
            <tr>
              <th scope="col">제목</th>
              <th scope="col">보낸 업체</th>

              <th scope="col">발주일</th>
              <th scope="col">납품기한</th>
            </tr>
          </thead>
          <tbody>
            <%if (typeof(req.session.Received_Order) !== 'undefined') {%> <% for
            (var key in req.session.Received_Order) { %>
            <tr>
              <th scope="row">
                <%= req.session.Received_Order[key]["Title"] %>
              </th>
              <td><%= req.session.Received_Order[key]["Order_Company"] %></td>
              <td>
                <%= req.session.Received_Order[key]["Order_date"].split('T')[0];
                %>
              </td>
              <td>
                <%=
                req.session.Received_Order[key]["Delivery_date"].split('T')[0];%>
              </td>
            </tr>
            <%}}%>
          </tbody>
        </table>

        <div
          class="col-12"
          style="
            text-align: center;
            background-color: white;
            position: absolute;
            top: 0;
            display: none;
          "
          id="myDIV"
        >
          <button
            type="button"
            onclick="toggleDiv(myDIV);
                    toggleDiv(myDIV2);
                    toggleDiv(POtable);"
            style="
              float: left;
              background-color: transparent;
              border: transparent;
            "
          >
            <i class="bi bi-x-lg"></i>
          </button>

          <div id="PO1" class="col-12" style="text-align: center">
            <div
              style="
                text-align: center;
                font-size: 3vmax;
                border-top: 1px solid #444444;
                border-left: 1px solid #444444;
                border-right: 1px solid #444444;
              "
            >
              발&nbsp;&nbsp;주&nbsp;&nbsp;서
            </div>
            <div
              style="
                text-align: center;
                font-size: 1vw;
                border-bottom: 1px solid #444444;
                border-left: 1px solid #444444;
                border-right: 1px solid #444444;
              "
            ></div>
            <div
              id="im_pc"
              class="d-flex border_B border_L border_R"
              style="
                align-items: center;
                justify-content: center;
                text-align: center;
                height: 250px;
              "
            >
              <div
                id="company-1"
                class="col-017 d-flex flex-wrap"
                style="height: 100%"
              >
                <%for (var key in req.session.Received_Order){%>
                <div
                  class="col-12 d-flex flex-wrap border_R border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">본사명</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Comp_NAME"
                      name="Comp_NAME"
                      value="<%=req.session.Received_Order[key]['Order_Company']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>

                <div
                  class="col-12 d-flex flex-wrap border_R border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">대표자 성명</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="President_NAME"
                      name="President_NAME"
                      value="<%=req.session.Received_Order[key]['President_NAME']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>

                <div
                  class="col-12 d-flex flex-wrap border_R border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">주소</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Business_Address"
                      name="Business_Address"
                      value="<%=req.session.Received_Order[key]['Business_Address']%>"
                      requiredun
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_R border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">Tel.</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="TEL"
                      name="TEL"
                      value="<%=req.session.Received_Order[key]['TEL']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_R border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">Fax.</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="FAX"
                      name="FAX"
                      value="<%=req.session.Received_Order[key]['FAX']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <%}%>
              </div>

              <div
                class="col-04 d-flex flex-wrap"
                style="
                  font-size: 1vmax;
                  border-right: 1px solid black;
                  height: 100%;
                "
              >
                <div calss="col-12" style="width: 100%">공</div>
                <div calss="col-12" style="width: 100%">급</div>
                <div calss="col-12" style="width: 100%">자</div>
              </div>

              <!--공급자-->
              <div
                id="company-2"
                class="col-017 d-flex flex-wrap"
                style="height: 100%"
              >
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">본사명</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Comp_NAM2"
                      name="Comp_NAME2"
                      value="<%=req.session.MyCompanyInfo[0]['Comp_NAME']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">대표자 성명</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="President_NAME_2"
                      name="President_NAME_2"
                      value="<%=req.session.MyCompanyInfo[0]['President_NAME']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">사업자 번호</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Business_NUM"
                      name="Business_NUM"
                      value="<%=req.session.MyCompanyInfo[0]['Business_NUM']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">본사 주소</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Business_Address_2"
                      name="Business_Address_2"
                      value="<%=req.session.MyCompanyInfo[0]['Business_ADDR']%>"
                      requiredun
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">공장 주소</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Business_Address_F"
                      name="Business_Address_F"
                      value="<%=req.session.MyCompanyInfo[0]['Factory_ADDR(OPTIONAL)']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">발주 담당자</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Manager"
                      name="Manager"
                      value="<%=req.session.UserName%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">Tel.</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="TEL2"
                      name="TEL2"
                      value="<%=req.session.MyCompanyInfo[0]['TEL']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
                <div
                  class="col-12 d-flex flex-wrap border_B"
                  style="align-items: center; justify-content: center"
                >
                  <div class="col-07 Poc_chat_font">Fax.</div>
                  <div
                    class="col-08 Poc_chat_font border_L"
                    style="height: 100%"
                  >
                    <input
                      type="text"
                      id="Fax2"
                      name="Fax2"
                      value="<%=req.session.MyCompanyInfo[0]['FAX']%>"
                      required
                      style="width: 100%; height: 100%; text-align: center"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12" style="height: 10wh">&nbsp;</div>
            <!-- 테이블 -->
            <table
              id="tableId"
              class="col-12 pc_chat"
              style="
                width: 100%;
                text-align: center;
                border-top: 1px solid #444444;
              "
            >
              <thead>
                <tr>
                  <th scope="col">No.</th>
                  <th scope="col">제품명</th>
                  <th scope="col">제품번호</th>
                  <th scope="col">규격</th>
                  <th scope="col">단위</th>
                  <th scope="col">수량</th>
                  <th scope="col">공급가액</th>
                  <th scope="col">부가세</th>
                  <th scope="col">비고</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">1</th>
                  <td>
                    <input
                      type="text"
                      id="Cannes_1_1"
                      name="Cannes_1_1"
                      value="Cannes_1_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        text-align: center;
                        outline: none;
                        border: none;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="Products_1"
                      name="Products_1"
                      value="Products_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="B_1"
                      name="B_1"
                      value="B_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="SI_1"
                      name="SI_1"
                      value="SI_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="Q_1"
                      name="Q_1"
                      value="Q_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="P_1"
                      name="P_1"
                      value="P_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="V_1"
                      name="V_1"
                      value="V_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      id="N_1"
                      name="N_1"
                      value="N_1"
                      required
                      style="
                        width: 100%;
                        height: 100%;
                        outline: none;
                        border: none;
                        text-align: center;
                      "
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <input
            style="color: #444444"
            value="IMG"
            type="file"
            class="real-upload"
            accept="image/*"
            required
            multiple
          />
          <div class="upload"></div>

          <div
            id="editor"
            class="image-preview"
            contenteditable="true"
            style="border-radius: 0"
          >
            <script>
              function getImageFiles(e) {
                const uploadFiles = [];
                const files = e.currentTarget.files;
                const imagePreview = document.querySelector(".image-preview");
                const docFrag = new DocumentFragment();

                // 파일 타입 검사
                [...files].forEach((file) => {
                  if (!file.type.match("image/.*")) {
                    alert("이미지 파일만 업로드가 가능합니다.");
                    return;
                  }

                  // 파일 갯수 검사
                  uploadFiles.push(file);
                  const reader = new FileReader();
                  reader.onload = (e) => {
                    const preview = createElement(e, file);
                    imagePreview.appendChild(preview);
                  };
                  reader.readAsDataURL(file);
                });
              }

              function createElement(e, file) {
                const li = document.createElement("div");
                const img = document.createElement("img");
                img.setAttribute("src", e.target.result);
                img.setAttribute("data-file", file.name);
                li.appendChild(img);

                return li;
              }

              const realUpload = document.querySelector(".real-upload");
              const upload = document.querySelector(".upload");

              upload.addEventListener("click", () => realUpload.click());

              realUpload.addEventListener("change", getImageFiles);
            </script>
          </div>
        </div>
      </div>

      <div class="col_resize_empty_2"></div>
      <!--채팅창 파트!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-->
      <div
        class="col_resize_chat content"
        id="myDIV2"
        style="display: none; text-align: center; font-size: 1.75vw"
      >
        <div>
          <div
            id="table-d"
            style="
              background-color: #d2e9f2;
              border: var(--bs-border-color-translucent) 1px solid;
            "
          >
            날짜 연월
          </div>
          <div
            id="chat_tables"
            class="col-12 test"
            style="
              word-break: break-all;
              border: var(--bs-border-color-translucent) 1px solid;
              background-color: #d2e9f2;
              min-height: 600px;
              max-height: 1100px;
              height: calc(82vh - 150px);
              overflow-y: scroll;
            "
          ></div>
        </div>
        <div id="myDIV3" class="d-sm-flex">
          <input
            type="text"
            rows="3"
            id="txt_on"
            style="width: 100%; border: transparent; outline: none"
            onkeyup="if(window.event.keyCode==13){createDiv()}"
          />
          <button
            type="button"
            onclick=" sendMessage();"
            class="btn btn-secondary"
            style="
              border: var(--bs-border-color-translucent) 1px solid;
              border-radius: 0;
            "
          >
            <i class="bi bi-send"></i>
          </button>
        </div>
      </div>
      <div class="col_resize_empty">&nbsp;</div>
    </div>
  </body>
</html>
